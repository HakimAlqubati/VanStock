<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        // 1. Insert Yemen
        $countryId = DB::table('countries')->insertGetId([
            'name' => 'اليمن',
            'code' => 'YE',
            'phone_code' => '967',
            'status' => true,
            'created_at' => now(),
            'updated_at' => now(),
        ]);

        // 2. Define Governorates (Cities) and their Districts
        $governorates = [
            'أمانة العاصمة' => [
                'أزال',
                'التحرير',
                'الثورة',
                'السبعين',
                'الصافية',
                'الوحدة',
                'بني الحارث',
                'شعوب',
                'صنعاء القديمة',
                'معين'
            ],
            'عدن' => [
                'التواهي',
                'المعلا',
                'الشيخ عثمان',
                'المنصورة',
                'البريقة',
                'دار سعد',
                'صيرة',
                'خور مكسر'
            ],
            'حضرموت' => [
                'المكلا',
                'الديس',
                'الريدة وقصيعر',
                'السوم',
                'الشحر',
                'الضليعة',
                'العبر',
                'القطن',
                'القف',
                'بروم وميفع',
                'تريم',
                'ثمود',
                'حجر',
                'حجر الصغير',
                'حريضة',
                'دوعن',
                'رخية',
                'رماة',
                'زمخ ومنوخ',
                'ساه',
                'سيئون',
                'شبام',
                'عمد',
                'غيل باوزير',
                'غيل بن يمين',
                'وادي العين',
                'يبعث'
            ],
            'تعز' => [
                'التعزية',
                'الشمايتين',
                'الصلو',
                'القاهرة',
                'المخا',
                'المسراخ',
                'المظفر',
                'المعافر',
                'المواسط',
                'الوازعية',
                'باب المندب',
                'جبل حبيش',
                'حيفان',
                'خدير',
                'سامع',
                'شرعب الرونة',
                'شرعب السلام',
                'صالة',
                'صبر الموادم',
                'ماوية',
                'مشرعة وحدنان',
                'مقبنة',
                'موزع'
            ],
            'الحديدة' => [
                'التحيتا',
                'الجراحي',
                'الضحي',
                'الدريهمي',
                'الزيدية',
                'السخنة',
                'السلخ',
                'المراوعة',
                'المنصورية',
                'حيس',
                'زبيد',
                'باجل',
                'برع',
                'بيت الفقيه',
                'حيران',
                'الخوخة',
                'القناوص',
                'كمران',
                'اللحية',
                'مدينة الحديدة',
                'مغربة'
            ],
            'إب' => [
                'إب',
                'العدين',
                'المخادر',
                'المشنة',
                'النادرة',
                'بعدان',
                'حبيش',
                'جبلة',
                'ذي السفال',
                'يريم',
                'الحزم',
                'الرضمة',
                'السبرة',
                'السدة',
                'السياني',
                'الشعر',
                'الظهار',
                'فرع العدين',
                'مذيخرة'
            ],
            'أبين' => [
                'سباح',
                'أحور',
                'زنجبار',
                'المحفد',
                'الوضيع',
                'جيشان',
                'خنفر',
                'لودر',
                'مودية',
                'رصد',
                'سرار'
            ],
            'البيضاء' => [
                'البيضاء',
                'الرياشية',
                'الزاهر',
                'السوادية',
                'الصومعة',
                'الطفة',
                'العرش',
                'القريشية',
                'الملاجم',
                'مكيراس',
                'مسورة',
                'نعمان',
                'ناطع',
                'ولد ربيع',
                'ردمان',
                'صباح',
                'مدينة البيضاء',
                'مدينة رداع',
                'رداع',
                'ذي ناعم'
            ],
            'لحج' => [
                'الحوطة',
                'الحد',
                'المسيمير',
                'الملاح',
                'المقاطرة',
                'القبيطة',
                'تبن',
                'حالمين',
                'حبيل جبر',
                'رادفان',
                'طور الباحة',
                'يافع',
                'المضاربة والعارة',
                'يهر',
                'الكرش'
            ],
            'مأرب' => [
                'مأرب',
                'الجوبة',
                'العبدية',
                'بدبدة',
                'جبل مراد',
                'حريب',
                'حريب القراميش',
                'رحبة',
                'رغوان',
                'صرواح',
                'ماهلية',
                'مجزر',
                'مدغل',
                'مدينة مأرب'
            ],
            'شبوة' => [
                'عتق',
                'بيحان',
                'جردان',
                'حبان',
                'حطيب',
                'دهر',
                'الروضة',
                'رضوم',
                'الطلح',
                'الصعيد',
                'عرماء',
                'عسيلان',
                'عين',
                'مرخة السفلى',
                'مرخة العليا',
                'ميفعة',
                'نصاب'
            ],
            'الجوف' => [
                'الحزم',
                'برط العنان',
                'الحميدات',
                'الخلق',
                'الزاهر',
                'الغيال',
                'المتكون',
                'المصلوب',
                'المطمة',
                'خب والشعف',
                'خراب المراشي',
                'رجوزة'
            ],
            'المهرة' => [
                'الغيظة',
                'المنصورة',
                'حوف',
                'حصوين',
                'قشن',
                'سيحوت',
                'المسيلة',
                'حات',
                'شحن'
            ],
            'المحويت' => [
                'المحويت',
                'مدينة المحويت',
                'الخبت',
                'الرجم',
                'الطويلة',
                'بني سعد',
                'حفاش',
                'شبام كوكبان',
                'ملحان'
            ],
            'صعدة' => [
                'صعدة',
                'باقم',
                'الحشوة',
                'الصفراء',
                'الظاهر',
                'غمر',
                'قطابر',
                'كتاف والبقع',
                'مجز',
                'منبه',
                'حيدان',
                'رازح',
                'سحار',
                'ساقين',
                'شداء'
            ],
            'حجة' => [
                'حجة',
                'مدينة حجة',
                'بكيل المير',
                'بني العوام',
                'بني قيس الطور',
                'حرض',
                'حيران',
                'خيران المحرق',
                'عبس',
                'قفل شمر',
                'كحلان الشرف',
                'كحلان عفار',
                'كشر',
                'مبين',
                'ميدي',
                'مستبأ',
                'المفتاح',
                'المحابشة',
                'المغربة',
                'نجرة',
                'الشاهل',
                'الشغادرة',
                'أسلم',
                'أفلح الشام',
                'أفلح اليمن',
                'الجميمة',
                'خيران',
                'شرس',
                'وضرة',
                'قارة'
            ],
            'الضالع' => [
                'الضالع',
                'الأزارق',
                'الحشاء',
                'الحصين',
                'الشعيب',
                'جبن',
                'جحاف',
                'دمت',
                'قعطبة'
            ],
            'عمران' => [
                'عمران',
                'العشة',
                'المدان',
                'القفلة',
                'السود',
                'السودة',
                'بني صريم',
                'ذيبين',
                'حبور ظليمة',
                'حرف سفيان',
                'حوث',
                'عيال سريح',
                'جبل عيال يزيد',
                'خمر',
                'خارف',
                'مسور',
                'ريدة',
                'شهارة',
                'سوير',
                'ثلاء'
            ],
            'ذمار' => [
                'ذمار',
                'مدينة ذمار',
                'الحداء',
                'المنار',
                'عنس',
                'جهران',
                'جبل الشرق',
                'مغرب عنس',
                'ميفعة عنس',
                'وصاب السافل',
                'وصاب العالي',
                'ضوران آنس'
            ],
            'ريمة' => [
                'الجبين',
                'الجعفرية',
                'السلفية',
                'بلاد الطعام',
                'كسمة',
                'مزهر'
            ],
            'صنعاء' => [
                'أرحب',
                'الحصن',
                'الحيمة الخارجية',
                'الحيمة الداخلية',
                'الطيال',
                'بلاد الروس',
                'بني حشيش',
                'بني مطر',
                'بني ضبيان',
                'جحانة',
                'خولان',
                'سنحان وبني بهلول',
                'صعفان',
                'مناخة',
                'نهم',
                'همدان'
            ],
            'سقطرى' => [
                'حديبو',
                'قلنسية وعبد الكوري'
            ]
        ];

        foreach ($governorates as $city => $districts) {
            $cityId = DB::table('cities')->insertGetId([
                'country_id' => $countryId,
                'name' => $city,
                'status' => true,
                'created_at' => now(),
                'updated_at' => now(),
            ]);

            $districtData = [];
            foreach ($districts as $district) {
                $districtData[] = [
                    'city_id' => $cityId,
                    'name' => $district,
                    'status' => true,
                    'created_at' => now(),
                    'updated_at' => now(),
                ];
            }

            DB::table('districts')->insert($districtData);
        }
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        // Get Yemen ID
        $yemen = DB::table('countries')->where('name', 'اليمن')->first();

        if ($yemen) {
            // Get all cities for Yemen
            $cities = DB::table('cities')->where('country_id', $yemen->id)->pluck('id');

            // Delete districts
            DB::table('districts')->whereIn('city_id', $cities)->delete();

            // Delete cities
            DB::table('cities')->where('country_id', $yemen->id)->delete();

            // Delete Yemen
            DB::table('countries')->where('id', $yemen->id)->delete();
        }
    }
};
